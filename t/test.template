=begin COPYRIGHT
Copyright © 2019 moretrim.

This file is part of the test suite for pds-companion.

To the extent possible under law, the author has waived all copyright
and related or neighboring rights to this file. This work is published
from France.

A copy of of the CC0 1.0 Universal license is also provided. If not,
see L<https://creativecommons.org/publicdomain/zero/1.0/>.
=end COPYRIGHT

use Test;
use lib 'lib';

use PDS;

my PDS::Grammar \test-grammar = PDS::Unstructured.new(source => $?FILE);

my \pds-script = q:to«END»;
END

my \expectations = [
];

is-deeply soup(test-grammar, pds-script), expectations, "can we parse the input";

use lib 't/resources';
use resource-mod;

is-deeply soup(test-grammar, resource-mod::resource), expectations, "can we parse the resource";

subtest "reject malformed inputs", {
    my \malformed-script = pds-script;

    throws-like
        { soup(test-grammar, malformed-script) },
        X::PDS::ParseError,
        message =>
            / "Cannot parse input: there was a note" /
            & / "at line 1" /,
        "malformed input was rejected";
}

done-testing;
